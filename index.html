<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    
    <title>ZUS loaction in Melaka</title>    
    <link
      rel="stylesheet"
      href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"
    />

    <style>
        /* Style the select element to fill 100% width */
        dropdown-container {
            width: 100%;
            display: flex;
            align-items: center;
        }

        label {
            margin-bottom: 8px;
        }
    </style>    
  </head>
  <body>
    <div style="display:flex;">
        <div id="map" style="width: 80%; height: 100vh"></div>
        <div class="dropdown-container">
          <label for="dropdownList">Select the outlet:</label>  
          <select id="dropdownList"></select>
        </div>
    </div>    
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    <script>
      // Creating map options
      var mapOptions = {
        //2.2083915913886116%2C102.20375061035156
        center: [2.2083915913886116, 102.20375061035156],
        zoom: 10,
      };

      // Creating a map object
      var map = new L.map("map", mapOptions);

      // Creating a Layer object
      var layer = new L.TileLayer(
        "http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
      );

      // Adding layer to the map
      map.addLayer(layer);

    //   let marker = new L.Marker([2.2083915913886116, 102.20375061035156]);
    //   marker.addTo(map);

    //   let markerAlt = new L.Marker([2.3083915913886116, 102.30375061035156]);
    //   markerAlt.addTo(map);
      const backendBaseUrl = "http://localhost:8080";

      function fetchDataAndPopulateDropdown() {
            console.log('fetchDataAndPopulateDropdown...');

            //const response = await 
            fetch(backendBaseUrl+"/outlets"+"/list",{
            //const response = await fetch("https://google.com",{
                mode: "cors", // no-cors, *cors, same-origin
                cache: "no-cache",                
            }).then(response => {
                console.log({response});
                return response.json();
            }).then(data => {
                console.log(data);
                // data = [
                //     {name:"A",geoLocation:[2.2083915913886116, 102.20375061035156]},
                //     {name:"B",geoLocation:[2.3083915913886116, 102.30375061035156]}
                // ]
    
                // Get the dropdown element by its ID
                const dropdown = document.getElementById("dropdownList");
    
                // Clear any existing options
                dropdown.innerHTML = "";
    
                // Iterate through the data and create options for the dropdown
                data.forEach((item) => {
                    const option = document.createElement("option");
                    option.text = item[0]; // Set the text content of the option
                    option.value = item[1]; // Set the value of the option
                    dropdown.appendChild(option); // Append the option to the dropdown
    
                    let marker = new L.Marker(item.geoLocation);
                    marker.addTo(map);            
              });
            }).catch((e) => {
                console.log("Error fetching data:", error);
            });
      }

      // Call the function to populate the dropdown on page load
      fetchDataAndPopulateDropdown();
    </script>
  </body>
</html>
